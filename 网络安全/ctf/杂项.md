
# 杂项


* 文件操作与隐写
* 图片隐写
* 压缩文件处理
* 流量取证技术

## 文件操作

* 文件类型识别
    1. File命令
        1. file myheart

    2. winhex

    3. 文件头错误/残缺

* 文件分离
    1. binwalk 工具
        1. 分析文件: binwalk filename
        2. 分离文件: binwalk -e filename
     
    2. foremost
        1. foremost pic.jpg -o pic

    3. dd
        1. 格式: dd if=源文件 of=输出文件名 bs=文件以几个字节分块 count=跳过第几块 skip=开始分
    
    4. winhex
    
    5. 010Editor

* 文件合并
    1. linux
        1. cat 文件1 文件2  > 文件
        2. 检测完整性: md5sum sim.jpg
    2. window
        1. copy /B 文件1+文件2+文件3  文件
        2. certutil -hashfile 文件名 md5 
    

## 图片隐写
* 细微的颜色差别
* gif图多帧隐藏
    - 颜色通道隐藏
    - 不同帧图信息隐藏
    - 不停帧对比隐藏
* exif信息隐藏
* 图片修复
    - 图片头修复
    - 图片尾修复
    - crc校验修复
    - 长、宽、高修复
* 最低有效位LSB隐写
* 图片加密

1. firework 工具

2. exif 工具

3. stegsolve

4. 图片隐写 LSB(隐藏最低有效位)
    1. stegsolve
    2. zsteg
        1. zsteg pic.png
    3. webstego4(针对bmp/pdf)
    4. python脚本
```python
#coding:utf-8
import PIL.Image
def foo():
    im = PIL.Image.open('01.bmp')
    im2 = im.copy()
    pix = im2.load()
    width,heght = im2.size
    
    for x in xrange(0, width):
        for y in xrange(0,height):
            if pix[x,y]&0x1 == 0:
                pix[x,y] = 0
            else:
            pix[x,y] = 255
    im2.show()
    pass

if __name__ == '__main__':
    foo()
    print 'ok.'
    pass
```

5. tweakpng
    1. crc出错
    2. 长、宽出错，导致crc不一致
```python
import os
import binascii
import struct
crcbp = open("2.png","rb").read()
for i in range(1024):
    for j in range(1024):
        data = crcbp[12.16] + struct.pack('>i',i)+ struct.pack('>i',j)+ crcbp[24:29]
        crc32 = binascii.crc32(data) & 0xffffffff
        if crc32 == 0xcbd6df8a:
            printf i,j
            printf "hex",hex(i),hex(j)
```

6. Bftools(解密图片信息)
    1. bftools.exe decode braincopter 图片名 -output 输出文件名
    2. bftools.exe run 上一步输出的文件
    
7. silenteye

8. jpg图像加密
    1. stegdetect
        1. stegdetect -s 敏感度 pic.jpg
     
    2. jphide
     
    3. outguess
        1. 该工具需要编译: ./configure && make && make install
        2. outguess -r 源文件名 输出文件名
    4. F5(stegdetect 识别出来是f5的文件)
        1.  java extract 文件名 -p 密码
    
    5. 二维码处理
        1. CQR
        
## 压缩文件处理

* 伪压缩
 > 1. zip:  
 >      使用winhex打开文件搜索16进制504B0102， 从50开始计算，第九第十字符为加密字段，将其设置为0000即可变为无加密状态  
 > 2. rar:  
 >      用WinRAR打开rar文件，找到24个字节，该字符尾数为4表示加密，0表示无加密
 >  
 * 暴力破解
 >  1.  rar:  
 >          ARCHPR.exe
 >  2.  zip:  
 >            
* 文件修复

## 流量取证

* 总体把握
    - 协议分级
    - 端口统计
    
* 过滤筛选
    - 过滤语法
    - Host，Protocol，contains，特征值

* 发现异常
    - 特殊字符串
    - 协议某字符串
    - flag位于服务器中

* 数据提取
    - 字符串提取
    - 文件提取
    
1. wireshark
    1. ip.src eq x.x.x.x or ip.dst eq x.x.x.x
    2. tcp.port eq 80 or udp.port eq 80
    3. tcp.dstport == 80
    4. tcp.srcport == 80
    5. tcp.port >= 1 and tcp.port <= 80
    6. eth.dst == A0:00:00:04:C5:84
    7. udp.length == 26
    8. tcp.len >= 7
    9. ip.len == 94
    10. frame.len == 119
    11. http.request.method == "POST"
    12. http contains "GET"


2. 无线wifi
    1. aircrack-ng 破解cap包
    
3. USB流量
    1. 键盘流量
        1. 右键leftover capture data -> 应用为列
    
        2. 土方法：文件-> 导出分组解析结果->为CSV
    
        3. 专业工具： tshark -r usb1.pcap -T fields -e usb.capdata > usbdata.txt
        
    2. 鼠标流量
        1. 0x00 代表没有按键；0x01 代表左键；0x02 代表右键
        2. 土方法：脚本
        3. gnuplot 画出来
            1. plot "xy.txt"
            
        4. 专业工具：https://github.com/WangYihang/UsbMiceDataHacker
             
        